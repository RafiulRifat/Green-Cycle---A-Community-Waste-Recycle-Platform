@model GreenCycle.Models.ViewModels.DashboardViewModel
@{
    ViewBag.Title = "Impact Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .wrap {
        max-width: 1000px;
        margin: 32px auto;
        padding: 24px;
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        background: #fff;
        font-family: system-ui,Arial;
    }

    .h1 {
        font-size: 36px;
        font-weight: 800;
        margin: 8px 0 20px;
    }

    .kpis {
        display: grid;
        grid-template-columns: repeat(3,1fr);
        gap: 18px;
        margin-bottom: 22px;
    }

    .kpi {
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        padding: 18px;
        text-align: center;
    }

        .kpi .num {
            font-size: 28px;
            font-weight: 800;
            color: #0a7a3f;
        }

        .kpi .label {
            color: #6b7280;
            margin-top: 4px;
        }

    .section {
        margin-top: 22px;
        margin-bottom: 6px;
        font-weight: 700;
        font-size: 18px;
    }

    .card {
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        padding: 12px;
    }

    .table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 8px;
    }

        .table th {
            font-weight: 600;
            color: #6b7280;
            text-align: left;
            padding: 10px 12px;
        }

        .table td {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-left: none;
            border-right: none;
            padding: 12px;
        }

        .table tr {
            border-radius: 10px;
        }

    .btnrow {
        display: flex;
        gap: 12px;
        margin-top: 18px;
    }

    .btn {
        padding: 12px 20px;
        border-radius: 10px;
        border: 1px solid #cbd5e1;
        text-decoration: none;
        color: #111;
        background: #fff;
    }

    .btn-primary {
        background: #0a7a3f;
        color: #fff;
        border: none;
    }

    .footer {
        margin-top: 24px;
        color: #6b7280;
        text-align: center;
        font-size: 12px;
    }
</style>

<div class="wrap">
    <div class="h1">Impact Dashboard</div>

    <div class="kpis">
        <div class="kpi">
            <div class="num">@Model.TotalCO2SavedKg.ToString("0.0") kg</div>
            <div class="label">Total CO₂ Saved</div>
        </div>
        <div class="kpi">
            <div class="num">@Model.ItemsDiverted</div>
            <div class="label">Items Diverted</div>
        </div>
        <div class="kpi">
            <div class="num">@Model.ChallengesJoined</div>
            <div class="label">Challenges Joined</div>
        </div>
    </div>

    <div class="section">Weekly CO₂ Saved</div>
    <div class="card">
        <canvas id="weeklyChart" height="120"></canvas>
    </div>

    <div class="section">Recent Activity</div>
    <div class="card">
        <table class="table">
            <thead>
                <tr>
                    <th style="width:25%;">Date</th>
                    <th style="width:35%;">Label</th>
                    <th style="width:20%;">Material</th>
                    <th style="width:20%;">CO₂ Saved</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var r in Model.Recent)
                {
                    <tr>
                        <td>@r.Date.ToString("MMM d, yyyy")</td>
                        <td>@r.Label</td>
                        <td>@r.Material</td>
                        <td>@r.SavedCO2Kg.ToString("0.00") kg</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="btnrow">
        <a class="btn btn-primary" href="@Url.Action("Index","Recognition")">Scan Item</a>
        <a class="btn" href="@Url.Action("Index","Challenges")">Join Challenge</a>
    </div>

    <div class="footer">© 2025 August&nbsp; GreenCycle</div>
</div>

<!-- Chart.js from CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  (function () {
    var labels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.WeeklyCO2.ConvertAll(p => p.WeekLabel)));
    var data   = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.WeeklyCO2.ConvertAll(p => p.Kg)));

    var ctx = document.getElementById('weeklyChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{ label: 'kg CO₂', data: data }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, title: { display: true, text: 'kg' } }
        }
      }
    });
  })();
</script>
